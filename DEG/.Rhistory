install.packages("BiocManager")
BiocManager::install("DESeq2")
BiocManager::install("Seurat")
BiocManager::install("tidyverse")
BiocManager::install("devtools")
BiocManager::install("VennDetail")
BiocManager::install("CellChat")
BiocManager::install("monocle")
devtools::install_github("guokai8/richR")
BiocManager::install("KEGGREST")
BiocManager::install("fgsea")
devtools::install_github("guokai8/richR")
install.packages("microbial")
install.packages("eoffice")
BiocManager::install("circlize")
BiocManager::install("rstairx")
BiocManager::install("rstarix")
BiocManager::install("rstatrix")
BiocManager::install("ALDEx2")
devtools::install_github("guokai8/scGSVA")
BiocManager::install("GSVA")
devtools::install_github("guokai8/CandiHap")
BiocManager::install("trackViewer")
BiocManager::install("rtracklayer")
BiocManager::install("rtracklayer")
devtools::install_github("guokai8/CandiHap")
BiocManager::install("muscle")
devtools::install_github("guokai8/CandiHap")
BiocManager::install("tidymodel")
BiocManager::install("tidymodels")
BiocManager::install("caret")
BiocManager::install("phyloseq")
BiocManager::install("dada2")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
install.packages("ggtext")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
install.packages("brm")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
install.packages("brms")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
library(tidybayes)        # Manipulate Stan objects in a tidy way
library(marginaleffects)  # Calculate marginal effects
library(modelr)           # For quick model grids
library(extraDistr)       # For dprop() beta distribution with mu/phi
install.packages("extraDistr")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
library(tidybayes)        # Manipulate Stan objects in a tidy way
library(marginaleffects)  # Calculate marginal effects
library(modelr)           # For quick model grids
library(extraDistr)       # For dprop() beta distribution with mu/phi
library(distributional)   # For plotting distributions with ggdist
library(palmerpenguins)   # Penguins!
install.packages("palmerpenguins")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
library(tidybayes)        # Manipulate Stan objects in a tidy way
library(marginaleffects)  # Calculate marginal effects
library(modelr)           # For quick model grids
library(extraDistr)       # For dprop() beta distribution with mu/phi
library(distributional)   # For plotting distributions with ggdist
library(palmerpenguins)   # Penguins!
library(kableExtra)       # For nicer tables
install.packages("kableExtra")
library(tidyverse)        # ggplot, dplyr, and friends
library(patchwork)        # Combine ggplot plots
library(ggtext)           # Fancier text in ggplot plots
library(scales)           # Labeling functions
library(brms)             # Bayesian modeling through Stan
library(tidybayes)        # Manipulate Stan objects in a tidy way
library(marginaleffects)  # Calculate marginal effects
library(modelr)           # For quick model grids
library(extraDistr)       # For dprop() beta distribution with mu/phi
library(distributional)   # For plotting distributions with ggdist
library(palmerpenguins)   # Penguins!
library(kableExtra)       # For nicer tables
set.seed(1234)
# Bayes stuff
# Use the cmdstanr backend for Stan because it's faster and more modern than
# the default rstan. You need to install the cmdstanr package first
# (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to
# install cmdstan on your computer.
options(mc.cores = 4,  # Use 4 cores
brms.backend = "cmdstanr")
bayes_seed <- 1234
# Colors from MetBrewer
clrs <- MetBrewer::met.brewer("Java")
install.packages("MetBrewer")
set.seed(1234)
# Bayes stuff
# Use the cmdstanr backend for Stan because it's faster and more modern than
# the default rstan. You need to install the cmdstanr package first
# (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to
# install cmdstan on your computer.
options(mc.cores = 4,  # Use 4 cores
brms.backend = "cmdstanr")
bayes_seed <- 1234
# Colors from MetBrewer
clrs <- MetBrewer::met.brewer("Java")
# Custom ggplot themes to make pretty plots
# Get Roboto Condensed at https://fonts.google.com/specimen/Roboto+Condensed
# Get Roboto Mono at https://fonts.google.com/specimen/Roboto+Mono
theme_pred <- function() {
theme_minimal(base_family = "Roboto Condensed") +
theme(panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "white", color = NA),
plot.title = element_text(face = "bold"),
strip.text = element_text(face = "bold"),
strip.background = element_rect(fill = "grey80", color = NA),
axis.title.x = element_text(hjust = 0),
axis.title.y = element_text(hjust = 0),
legend.title = element_text(face = "bold"))
}
theme_pred_dist <- function() {
theme_pred() +
theme(plot.title = element_markdown(family = "Roboto Condensed", face = "plain"),
plot.subtitle = element_text(family = "Roboto Mono", size = rel(0.9), hjust = 0),
axis.text.y = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank())
}
theme_pred_range <- function() {
theme_pred() +
theme(plot.title = element_markdown(family = "Roboto Condensed", face = "plain"),
plot.subtitle = element_text(family = "Roboto Mono", size = rel(0.9), hjust = 0),
panel.grid.minor.y = element_blank())
}
update_geom_defaults("text", list(family = "Roboto Condensed", lineheight = 1))
penguins <- penguins |>
drop_na(sex) |>
mutate(is_gentoo = species == "Gentoo") |>
mutate(bill_ratio = bill_depth_mm / bill_length_mm)
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
geom_point(size = 1, alpha = 0.7) +
geom_smooth(method = "lm", color = clrs[5], se = FALSE) +
scale_y_continuous(labels = label_comma()) +
coord_cartesian(ylim = c(2000, 6000)) +
labs(x = "Flipper length (mm)", y = "Body mass (g)") +
theme_pred()
library(KinSwingR)
data(example_phosphoproteome)
data(phosphositeplus_human)
head(example_phosphoproteome)
head(phosphositeplus_human)
sample_data <- head(example_phosphoproteome, 1000)
set.seed(1234)
sample_pwm <- phosphositeplus_human[sample(nrow(phosphositeplus_human), 1000),]
CAMK2A_example <- phosphositeplus_human[phosphositeplus_human[,1]== "CAMK2A",]
head(phosphositeplus_human)
pwms <- buildPWM(sample_pwm)
CAMK2A_pwm <- buildPWM(CAMK2A_example)
CAMK2A <- viewPWM(CAMK2A_pwm,
which_pwm="CAMK2A",
view_pwm = TRUE,
color_scheme = "shapely")
q()
library(GSVA)
?gsvaParam
gsva
?gsva
library(BiocParallel)
bpparam <- MulticoreParam()
bpparam
bpparam <- MulticoreParam(8)
bpparam
bpnworkers(MulticoreParam(4))
setwd("Desktop/Project/Step/new/DEG/")
list.files(pattern="mySC.csv\")
list.files(pattern="mySC.csv")
filenames<-list.files(pattern="mySC.csv")
mysc<-lapply(filenames, function(x)read.csv(x,row.names = 1))
filenames
sub('_mySC.csv','',filenames)
names(mysc)<-sub('_mySC.csv','',filenames)
head(mysc$DREXvsDR)
subset(mysc$HFDvsSD,p_val<0.01)%>%dim()
library(tidyverse)
subset(mysc$HFDvsSD,p_val<0.01)%>%dim()
myscs<-lapply(mysc, function(x)subset(x,p_val<0.01))
anno<-read.csv("../../mouse_symbol_entrezid.csv",row.names = 1)
head(anno)
allg<-anno$entrezgene_id
allg<-allg[allg!="."]
allg<-unlist(lapply(strsplit(allg,","),'[[',1))
#######
spai.function<-function(x,group=NULL,allg=NULL){
tmp<-x[[group]]
xg<-tmp$log2FoldChange
names(xg)<-anno[rownames(tmp),"entrezgene_id"]
xg<-xg[names(xg)!="."]
names(xg)<-unlist(lapply(strsplit(names(xg),","),'[[',1))
#only keep the unique gene
xg<-xg[names(which(table(names(xg))==1))]
resp<-spia(de=xg, all=allg, organism="mmu",beta=NULL,nB=2000,plots=FALSE, verbose=TRUE,combine="fisher")
return(resp)
}
#######
spai.function<-function(x,group=NULL,allg=NULL){
tmp<-x[[group]]
xg<-tmp$avg_log2FC
names(xg)<-anno[rownames(tmp),"entrezgene_id"]
xg<-xg[names(xg)!="."]
names(xg)<-unlist(lapply(strsplit(names(xg),","),'[[',1))
#only keep the unique gene
xg<-xg[names(which(table(names(xg))==1))]
resp<-spia(de=xg, all=allg, organism="mmu",beta=NULL,nB=2000,plots=FALSE, verbose=TRUE,combine="fisher")
return(resp)
}
names(myscs)
####
groups<-c("HFDvsSD","EXvsHFD","DREXvsHFD","DRvsHFD")
groups<-c("HFDvsSD","EXvsHFD","DREXvsHFD","DRvsHFD")
myscss<-myscs[groups]
library(SPIA)
resmysc<-lapply(names(myscss), function(x)spai.function(myscss,group=x,allg=allg))
names(resmysc)<-names(myscss)
rr<-do.call(rbind,resmysc)
head(rr)
rr$Group<-sub('\\..*','',rownames(rr))
rr%>%filter(pG<0.05)%>%ggplot(aes(Group,Name,size=-log10(pG),color=Status))+geom_point()+xlab("")+ylab("")+theme_light(base_size = 12)+
xlim(c("HFDvsSD","DRvsHFD","EXvsHFD","DREXvsHFD"))+theme(axis.text.x=element_text(angle=90,vjust =0.5,hjust = 1))
dev.print(pdf,file="mysc_SPIA.pdf")
write.csv(rr,file="mysc_spia.csv")
####
filenames<-list.files(pattern="nmSC.csv")
filenames
filenames<-list.files(pattern="nmSC.csv")
nmsc<-lapply(filenames, function(x)read.csv(x,row.names = 1))
names(nmsc)<-sub('_nmSC.csv','',filenames)
nmscs<-lapply(nmsc, function(x)subset(x,p_val<0.01))
filenames<-list.files(pattern="nmSC.csv")
nmsc<-lapply(filenames, function(x)read.csv(x,row.names = 1))
names(nmsc)<-sub('_nmSC.csv','',filenames)
nmscs<-lapply(nmsc, function(x)subset(x,p_val<0.01))
nmscss<-nmscs[groups]
resnmsc<-lapply(names(nmscss), function(x)spai.function(nmscss,group=x,allg=allg))
names(resnmsc)<-names(nmscss)
rr<-do.call(rbind,resnmsc)
rr$Group<-sub('\\..*','',rownames(rr))
rr%>%filter(pG<0.05)%>%ggplot(aes(Group,Name,size=-log10(pG),color=Status))+geom_point()+xlab("")+ylab("")+theme_light(base_size = 12)+
xlim(c("HFDvsSD","DRvsHFD","EXvsHFD","DREXvsHFD"))+theme(axis.text.x=element_text(angle=90,vjust =0.5,hjust = 1))
dev.print(pdf,file="nmsc_SPIA.pdf")
write.csv(rr,file="nmsc_spia.csv")
ls()
####
filenames<-list.files(pattern="_Mac.csv")
filenames
mac<-lapply(filenames, function(x)read.csv(x,row.names = 1))
names(mac)<-sub('_Mac.csv','',filenames)
macs<-lapply(mac, function(x)subset(x,p_val<0.01))
macss<-macs[groups]
###
resmac<-lapply(names(macss), function(x)spai.function(macss,group=x,allg=allg))
names(resmac)<-names(macss)
rr<-do.call(rbind,resmac)
rr$Group<-sub('\\..*','',rownames(rr))
rr%>%filter(pG<0.05)%>%ggplot(aes(Group,Name,size=-log10(pG),color=Status))+geom_point()+xlab("")+ylab("")+theme_light(base_size = 12)+
xlim(c("HFDvsSD","DRvsHFD","EXvsHFD","DREXvsHFD"))+theme(axis.text.x=element_text(angle=90,vjust =0.5,hjust = 1))
dev.print(pdf,file="mac_SPIA.pdf")
write.csv(rr,file="mac_spia.csv")
####
filenames<-list.files(pattern="_Perineurial.csv")
filenames
per<-lapply(filenames, function(x)read.csv(x,row.names = 1))
names(per)<-sub('_Perineurial.csv','',filenames)
pers<-lapply(per, function(x)subset(x,p_val<0.01))
perss<-pers[groups]
###
resper<-lapply(names(perss), function(x)spai.function(perss,group=x,allg=allg))
names(resper)<-names(perss)
rr<-do.call(rbind,resper)
rr$Group<-sub('\\..*','',rownames(rr))
rr%>%filter(pG<0.05)%>%ggplot(aes(Group,Name,size=-log10(pG),color=Status))+geom_point()+xlab("")+ylab("")+theme_light(base_size = 12)+
xlim(c("HFDvsSD","DRvsHFD","EXvsHFD","DREXvsHFD"))+theme(axis.text.x=element_text(angle=90,vjust =0.5,hjust = 1))
dev.print(pdf,file="Perineurial_SPIA.pdf")
write.csv(rr,file="Perineurial_spia.csv")
save(list=ls(),file="steph_spia.rdata",compress=T)
q()
