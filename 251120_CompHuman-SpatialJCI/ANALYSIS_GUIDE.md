# Analysis Scripts Guide

This document provides detailed descriptions of each analysis script in the DPN/DREX project, which compares mouse peripheral nerve scRNA-seq data against human spatial transcriptomics and bulk RNA-seq datasets to understand diabetic peripheral neuropathy and intervention effects.

---

## Script 00: Primary Enrichment Analysis
**File:** `00_enrichment_JCI_Schwann_mouse.R`
**Output:** `Output_JCI/00_DEGoverlap_Enrichment_Analysis/`

This is the foundational analysis that must be run first, as all downstream analyses (scripts 01-08) depend on its outputs. The script reads mouse scRNA-seq DEG files from multiple diet/exercise intervention comparisons (HFDvsSD, DRvsHFD, EXvsHFD, DREXvsHFD) across Schwann cell subtypes (mySC, nmSC, ImmSC, majorSC, and aggSC). Mouse DEGs are filtered using raw p-value < 0.01 (not adjusted p-value) to capture early intervention responses. The script first creates aggSC (aggregated Schwann cell) files by combining mySC, nmSC, and ImmSC DEGs, keeping only the most significant gene (lowest p-value) when duplicates exist across subtypes. It maps human DEGs from two independent datasets—JCI_SC (Schwann cell spatial transcriptomics) and JCI_Bulk (bulk RNA-seq from diabetic nerve biopsies)—to mouse orthologs using homologene. Human DEGs are filtered more stringently (padj < 0.001, |log2FC| > 1) to ensure high-confidence human disease genes. For each mouse comparison/cell-type combination, the script calculates overlap gene sets (Mouse∩JCI_SC, Mouse∩JCI_Bulk, JCI_SC∩JCI_Bulk, and all three), as well as unique gene sets for each dataset. It then performs GO and KEGG pathway enrichment analysis using richR (with builtin=FALSE for KEGG) on all gene sets that contain ≥5 genes. The output includes gene lists, Venn diagrams showing three-way overlaps, and enrichment results tables for each comparison, providing a comprehensive view of shared and unique biological processes between mouse intervention models and human diabetic neuropathy.

---

## Script 01: Cell Type-Specific Enrichment Comparison
**File:** `01_celltype_enrichment_comparison.R`
**Output:** `Output_JCI/01_CellType_Comparison/`

This analysis identifies which biological pathways are shared across multiple Schwann cell subtypes versus those that are uniquely enriched in specific subtypes, helping to distinguish universal responses from cell-type-specific functions in diabetic neuropathy. The script reads the enrichment results generated by Script 00 and systematically compares GO and KEGG pathway enrichment across all four Schwann cell types (mySC, nmSC, ImmSC, majorSC) for each intervention comparison. It classifies pathways into three categories: "Shared" (appearing in ≥3 cell types), "Cell-type-specific" (unique to one cell type), and "Partially shared" (appearing in 2 cell types). The analysis generates heatmaps showing the significance (-log10 padj) of top pathways across cell types, dot plots highlighting the most enriched terms, and detailed tables listing which cell types exhibit each pathway. This reveals whether interventions like DREX affect fundamental Schwann cell biology uniformly or trigger distinct molecular programs in different subtypes, which is crucial for understanding the cellular heterogeneity of therapeutic responses.

---

## Script 02: Intervention Response Analysis
**File:** `02_intervention_response.R`
**Output:** `Output_JCI/02_Intervention_Response/`

This analysis dissects the specific molecular effects of different interventions—diet restriction (DR), exercise (EX), and their combination (DREX)—to identify genes and pathways that are uniquely modulated by each treatment strategy versus those showing synergistic effects. The script examines gene overlaps across intervention comparisons to distinguish DR-specific effects (genes changed in DRvsHFD and HFDvsSD), exercise-specific effects (genes in EXvsHFD), and DREX-specific effects (genes uniquely appearing in DREXvsHFD that weren't in DR or EX alone). It generates Venn diagrams illustrating intervention-specific versus shared gene sets, creates detailed gene lists for each intervention effect category, and produces summary statistics quantifying the magnitude of each intervention's impact across cell types. By comparing these patterns against the human JCI datasets, the analysis reveals which mouse intervention effects are most relevant to human diabetic neuropathy pathology, helping prioritize therapeutic strategies. The outputs include intervention-specific enrichment analyses and visualizations showing whether combined DREX produces additive, synergistic, or unique molecular responses compared to individual interventions.

---

## Script 03: Conservation Analysis
**File:** `03_conservation_analysis.R`
**Output:** `Output_JCI/03_Conservation_Analysis/`

This analysis identifies genes and pathways that are consistently dysregulated across mouse models and human diabetic neuropathy, providing the strongest candidates for translatable biomarkers and therapeutic targets. The script systematically compares gene expression changes between mouse interventions and human datasets (JCI_SC and JCI_Bulk) to identify "highly conserved" genes—those that appear in overlaps across multiple comparisons and cell types, indicating robust cross-species relevance. It calculates conservation scores based on how frequently each gene appears in mouse-human overlap sets, ranks pathways by their conservation across species and conditions, and generates summary tables listing the most conserved biological processes. The analysis produces pathway comparison heatmaps showing enrichment patterns across species, conservation statistics quantifying the degree of mouse-human concordance for each intervention, and lists of high-confidence translatable genes that show consistent dysregulation. These conserved genes represent the most reliable targets for therapeutic development, as they demonstrate consistent pathology across independent experimental systems and human patient samples.

---

## Script 04: Direction of Change Analysis
**File:** `04_direction_of_change.R`
**Output:** `Output_JCI/04_Direction_Analysis/`

This analysis goes beyond simple gene overlap to examine whether genes change in the same direction (concordant) or opposite directions (discordant) between mouse and human datasets, which is critical for validating mouse models and interpreting intervention effects. The script reads DEG files with log2 fold changes, maps human genes to mouse orthologs while preserving directionality, and classifies overlapping genes into concordant (same sign of log2FC) or discordant (opposite sign) categories for both Mouse∩JCI_SC and Mouse∩JCI_Bulk comparisons. It generates detailed tables listing concordant and discordant genes with their fold changes in both species, calculates concordance rates (percentage of overlapping genes showing same direction), and produces summary statistics across all comparisons. The analysis creates visualizations showing the proportion of concordant versus discordant changes for each intervention and cell type. High concordance rates validate that mouse interventions recapitulate human disease mechanisms, while discordant genes may reveal species-specific responses or artifacts. This information is crucial for interpreting whether an intervention that "improves" gene expression in mice (e.g., DREX reversing HFD effects) would have the same therapeutic benefit in humans.

---

## Script 05: Leading Edge Genes and Hub Gene Analysis
**File:** `05_leading_edge_genes.R`
**Output:** `Output_JCI/05_Leading_Edge_Analysis/`

This analysis identifies "hub genes"—genes that appear repeatedly across multiple enriched pathways and intervention comparisons, suggesting they play central regulatory roles in diabetic neuropathy pathophysiology. The script analyzes the gene lists from enrichment results to find genes that participate in numerous significantly enriched GO/KEGG pathways, calculates a "hub score" for each gene based on the number and significance of pathways it contributes to, and identifies genes that are hubs across multiple cell types (cross-cell-type hubs), indicating master regulators of Schwann cell dysfunction. It generates network diagrams visualizing the connections between hub genes and enriched pathways, produces ranked lists of top hub genes with their associated pathways and scores, and creates summary tables showing which hub genes are conserved between mouse and human datasets. Hub genes represent priority therapeutic targets because modulating them could affect multiple disease-relevant pathways simultaneously. The analysis also identifies cell-type-specific versus pan-Schwann-cell hub genes, helping distinguish targets that would broadly affect all Schwann cells from those with subtype-specific effects. Typically, this analysis identifies 10-20 hub genes that warrant detailed mechanistic investigation.

---

## Script 06: Bioenergetic and Metabolic Focus
**File:** `06_bioenergetic_focus.R`
**Output:** `Output_JCI/06_Bioenergetic_Focus/`

This specialized analysis focuses specifically on metabolic and bioenergetic pathways, which are particularly relevant to diabetic neuropathy where Schwann cell energy metabolism and lactate support for axons are known to be disrupted. Unlike Script 00 which performs broad enrichment across all pathways, this script performs targeted enrichment analysis on curated metabolic gene sets including glycolysis, oxidative phosphorylation, fatty acid metabolism, lactate metabolism, and mitochondrial function. It reads the same mouse DEG files (using p < 0.01 cutoff) and human datasets but applies bioenergetics-focused filters and annotations, calculates metabolic pathway scores for each comparison, and identifies genes specifically involved in Schwann cell metabolic support of axons. The analysis generates enrichment results emphasizing KEGG metabolic pathways, creates detailed gene lists of dysregulated metabolic genes with their fold changes across species, and produces summary statistics quantifying metabolic dysfunction in each intervention group. The outputs include specialized visualizations showing how different interventions (DR, EX, DREX) affect specific branches of cellular metabolism and whether metabolic gene expression patterns are conserved between mouse and human. This focused analysis complements the broader pathway analysis from Script 00 by providing deep insight into a disease mechanism that is central to diabetic neuropathy pathogenesis and may be particularly amenable to intervention through diet and exercise.

---

## Script 07: PPI Network Analysis
**File:** `07_ppi_network_analysis.R`
**Output:** `Output_JCI/07_PPI_Network_Analysis/`

This analysis uses the STRING database to identify protein-protein interaction (PPI) networks among differentially expressed genes, revealing functional modules and highly connected hub proteins that may be central to disease mechanisms. The script focuses on majorSC and aggSC mouse cell types as well as human JCI_SC DEGs, initializing separate STRING database connections for mouse (species ID 10090) and human (species ID 9606) with medium confidence interaction scores (≥400). For each dataset, it maps gene symbols to STRING protein IDs, performs PPI enrichment analysis to test whether the DEG proteins show more interactions than would be expected by chance (indicating functional coherence), and generates network visualizations showing the top 200 proteins and their interaction patterns. The analysis also performs functional enrichment (GO Biological Process and KEGG) specifically on the PPI network members to identify which biological pathways are represented in highly connected protein modules. The outputs include network plots as PDF files showing protein interaction topologies, PPI enrichment statistics with p-values indicating network significance, STRING-based GO and KEGG enrichment results for network members, and summary tables comparing PPI enrichment across interventions and cell types. Significant PPI enrichment (p < 0.05) indicates that the DEGs form functional modules rather than random gene sets, validating biological coherence. Highly connected proteins in these networks represent priority therapeutic targets, as they likely coordinate multiple disease-relevant processes.

---

## Script 08: Pathway Overlap Heatmaps
**File:** `08_pathway_overlap_heatmaps.R`
**Output:** `Output_JCI/08_Pathway_Overlap_Heatmaps/`

This analysis creates comprehensive heatmap visualizations showing which enriched pathways are shared versus unique across four key datasets: mouse majorSC, mouse aggSC, human JCI_SC (Schwann cell spatial), and human JCI_Bulk (nerve bulk RNA-seq). The script reads enrichment results from Script 00 for all comparison groups and creates binary pathway matrices indicating presence (1) or absence (0) of each significantly enriched pathway (padj < 0.05) in each of the four datasets. For both GO and KEGG enrichment types, it generates heatmaps with pathways sorted by conservation level (most shared pathways at top), identifies "conserved pathways" appearing in ≥3 datasets that represent core disease mechanisms, and creates separate gene lists for dataset-specific pathways that may reveal unique molecular features. The analysis produces separate heatmaps for each comparison group (HFDvsSD, DRvsHFD, EXvsHFD, DREXvsHFD) and enrichment type (GO/KEGG), with pathway names truncated to 80 characters for readability and limited to top 50 pathways per heatmap when total exceeds this threshold. Summary statistics quantify the number of conserved pathways, mouse-specific pathways (present in majorSC/aggSC but not in human datasets), and human-specific pathways (present in JCI_SC/JCI_Bulk but not in mouse datasets). The master summary Excel file compiles these statistics across all comparisons, enabling quick identification of intervention effects that are well-conserved versus those showing species divergence. This analysis is crucial for prioritizing pathways with strong translational relevance and understanding the limitations of mouse models for specific biological processes.

---

## Script 09: Overlap Significance Analysis
**File:** `09_overlap_significance_analysis.R`
**Output:** `Output_JCI/09_Overlap_Significance/`

This analysis provides rigorous statistical validation that the observed gene overlaps between mouse DEGs and human Schwann cell DEGs are not occurring by random chance, using a genome-wide background and hypergeometric distribution testing. While Script 00 identifies which genes overlap between mouse and human datasets, this script answers the critical question: "Are these overlaps statistically significant?" The script uses a **20,000 gene background** representing the full mouse genome (rather than just the ~7,000 detected genes in the dataset), which provides a more conservative and biologically appropriate statistical test. For each of the 63 mouse DEG files (9 comparisons × 7 cell types), it calculates the expected overlap with 110 human Schwann genes (mapped mouse orthologs from the 194 human Schwann DEGs) using the **hypergeometric distribution formula**: Expected = (n₁ × n₂) / N, where n₁ = mouse DEGs, n₂ = human Schwann genes, and N = 20,000. The analysis computes Z-scores measuring how many standard deviations the observed overlap is above the expected random overlap, calculates exact p-values using normal approximation, and determines enrichment fold changes (observed/expected). Critically, the analysis reveals that **ALL 9 Schwann cell (majorSC) comparisons are highly significant** (p < 0.001), and **83% of all 60 comparisons are significant** (p < 0.05), confirming genuine biological conservation. The disease baseline (HFDvsSD majorSC) shows the strongest significance (Z=7.18, p=3.58e-13, 5.68-fold enrichment), while DREX fibroblasts show the highest enrichment overall (12.43-fold, Z=13.08, p=2.10e-39). The outputs include a comprehensive CSV summary table with observed/expected overlaps, Z-scores, p-values, and enrichment for all comparisons; five visualization plots (Z-score plot with significance thresholds, p-value plot, enrichment fold plot, observed vs. expected scatter plot, and comparison group summary); and a detailed markdown summary (`SUMMARY_Overlap_Significance_Analysis.md`) with biological interpretation, methodological details, and translational implications. This analysis provides the statistical rigor needed to support claims of mouse-human conservation in publications and validates that mouse intervention models genuinely recapitulate human DPN mechanisms rather than showing coincidental gene overlaps.

---

## Output Directory Structure

All analyses output to a unified directory structure:

```
Output_JCI/
├── Master_Enrichment_Summary.csv                # Overall summary from Script 00
├── Master_Enrichment_Summary.xlsx               # Excel version with multiple sheets
├── 00_DEGoverlap_Enrichment_Analysis/           # Script 00: Raw enrichment results (20 subdirectories)
├── 01_CellType_Comparison/                      # Script 01: Cell-type comparisons
├── 02_Intervention_Response/                    # Script 02: Intervention-specific effects
├── 03_Conservation_Analysis/                    # Script 03: Cross-species conservation
├── 04_Direction_Analysis/                       # Script 04: Concordance/discordance
├── 05_Leading_Edge_Analysis/                    # Script 05: Hub genes and networks
├── 06_Bioenergetic_Focus/                       # Script 06: Metabolic pathways
├── 07_PPI_Network_Analysis/                     # Script 07: STRING PPI networks
├── 08_Pathway_Overlap_Heatmaps/                 # Script 08: Pathway conservation heatmaps
└── 09_Overlap_Significance/                     # Script 09: Statistical significance testing
```

---

## Analysis Workflow

**Required Execution Order:**
1. **First:** Run Script 00 (generates enrichment data and aggSC files)
2. **Then:** Run Scripts 01-09 in any order (all depend on Script 00 output)
   - Scripts 01-05, 08: Read from enrichment results
   - Scripts 04, 06, 07: Read DEG files directly (including aggSC)
   - Script 09: Reads human Schwann DEGs and all mouse DEG files for significance testing

**Typical Analysis Session:**
```bash
# Step 1: Generate primary enrichment data and aggSC files
Rscript 00_enrichment_JCI_Schwann_mouse.R

# Step 2: Run downstream analyses (can be parallel or sequential)
Rscript 01_celltype_enrichment_comparison.R
Rscript 02_intervention_response.R
Rscript 03_conservation_analysis.R
Rscript 04_direction_of_change.R
Rscript 05_leading_edge_genes.R

# Step 3: Run specialized analyses
Rscript 06_bioenergetic_focus.R
Rscript 07_ppi_network_analysis.R
Rscript 08_pathway_overlap_heatmaps.R

# Step 4: Statistical validation of overlaps (recommended after Script 00)
Rscript 09_overlap_significance_analysis.R
```

---

## Key Parameters Applied Across All Scripts

**Cell Types Analyzed:**
- `mySC` - Myelinating Schwann cells
- `nmSC` - Non-myelinating Schwann cells
- `ImmSC` - Immature Schwann cells
- `majorSC` - Combined major Schwann cell population
- `aggSC` - Aggregated Schwann cells (mySC + nmSC + ImmSC, most significant genes only)

**Intervention Comparisons:**
- `HFDvsSD` - High-fat diet vs. standard diet (disease model)
- `DRvsHFD` - Diet restriction vs. high-fat diet (DR intervention)
- `EXvsHFD` - Exercise vs. high-fat diet (exercise intervention)
- `DREXvsHFD` - Combined DR+exercise vs. high-fat diet (combination therapy)

**Human Reference Datasets:**
- `JCI_SC` - Human Schwann cell spatial transcriptomics DEGs (Severe vs. Moderate DPN)
- `JCI_Bulk` - Human bulk RNA-seq DEGs from diabetic nerve biopsies

**Significance Thresholds:**
- Mouse DEGs: p-value < 0.01 (raw p-value, not adjusted)
- Human DEGs: padj < 0.001 and |log2FC| > 1 (stringent filtering for high-confidence genes)
- Pathway enrichment: padj < 0.05
- Minimum gene set size for enrichment: 5 genes

**Enrichment Methods:**
- GO Biological Process (GO:BP) via richR
- KEGG Pathways via richR (with builtin=FALSE)
- PPI networks via STRINGdb (v12.0, score threshold 400)

**Statistical Testing (Script 09):**
- Background size: 20,000 mouse genes (full genome)
- Statistical method: Hypergeometric distribution (analytical formula)
- Human Schwann genes: 194 (110 mapped to mouse background)
- Significance levels: * p<0.05, ** p<0.01, *** p<0.001

---

## Interpretation Guide

**High Overlap with Human Datasets:** Indicates the mouse intervention model recapitulates human disease mechanisms well. These genes/pathways are the most translationally relevant.

**Concordant Direction of Change:** Genes showing the same direction of fold change in mouse and human provide strong validation of disease mechanisms and therapeutic targets.

**Hub Genes:** Genes appearing in multiple enriched pathways across comparisons represent master regulators and priority therapeutic targets.

**Cell-Type-Specific Effects:** Pathways unique to one Schwann cell subtype suggest specialized functions that may require targeted therapeutic approaches.

**Intervention-Specific Genes:** Genes uniquely modulated by DREX (but not by DR or EX alone) reveal synergistic mechanisms and optimal therapeutic strategies.

**Conserved Pathways:** Biological processes enriched consistently across multiple comparisons, cell types, and species represent core disease mechanisms with high confidence.

**Statistically Significant Overlaps:** Overlaps with p < 0.05 (Script 09) indicate genuine biological conservation rather than random chance. Higher Z-scores (>5) and enrichment folds (>3x) represent the strongest cross-species conservation.

**Enrichment Fold Change:** Ratio of observed to expected overlap. Values >2x indicate biologically meaningful conservation. The highest enrichments (>10x) identify the most critical conserved mechanisms.

---

## Citation & Data Sources

**Mouse scRNA-seq Data:** DEG files in `../DEG/` and `../DEG_Major/`
**Human Schwann Cell Data:** `DEGs_JCI_DPN/SchwannDEG_Severe-Moderate_noMito.csv`
**Human Bulk RNA-seq Data:** `DEGs_JCI_DPN/JCI184075.sdd3_BulkRNAseqDEGs.xlsx`
**Gene Orthology Mapping:** homologene package (NCBI HomoloGene database)
**Enrichment Analysis:** richR package (GO.db and KEGG.db via KEGGREST)

---

*Last Updated: December 4, 2025*
*Analysis Pipeline Version: 2.2 (Added statistical significance testing of overlaps with genome-wide background, hypergeometric distribution)*
