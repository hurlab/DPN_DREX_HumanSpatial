# Analysis Scripts Guide

This document provides detailed descriptions of each analysis script in the DPN/DREX project, which compares mouse peripheral nerve scRNA-seq data against human spatial transcriptomics and bulk RNA-seq datasets to understand diabetic peripheral neuropathy and intervention effects.

---

## Script 00: Primary Enrichment Analysis
**File:** `00_enrichment_JCI_Schwann_mouse.R`
**Output:** `Output_JCI/Enrichment_Analysis/`

This is the foundational analysis that must be run first, as all downstream analyses (scripts 01-05) depend on its outputs. The script reads mouse scRNA-seq DEG files from multiple diet/exercise intervention comparisons (HFDvsSD, DRvsHFD, EXvsHFD, DREXvsHFD) across Schwann cell subtypes (mySC, nmSC, ImmSC, majorSC). It maps human DEGs from two independent datasets—JCI_SC (Schwann cell spatial transcriptomics) and JCI_Bulk (bulk RNA-seq from diabetic nerve biopsies)—to mouse orthologs using homologene. For each mouse comparison/cell-type combination, the script calculates overlap gene sets (Mouse∩JCI_SC, Mouse∩JCI_Bulk, JCI_SC∩JCI_Bulk, and all three), as well as unique gene sets for each dataset. It then performs GO and KEGG pathway enrichment analysis using richR (with builtin=FALSE for KEGG) on all gene sets that contain ≥5 genes. The output includes gene lists, Venn diagrams showing three-way overlaps, and enrichment results tables for each comparison, providing a comprehensive view of shared and unique biological processes between mouse intervention models and human diabetic neuropathy.

---

## Script 01: Cell Type-Specific Enrichment Comparison
**File:** `01_celltype_enrichment_comparison.R`
**Output:** `Output_JCI/CellType_Comparison/`

This analysis identifies which biological pathways are shared across multiple Schwann cell subtypes versus those that are uniquely enriched in specific subtypes, helping to distinguish universal responses from cell-type-specific functions in diabetic neuropathy. The script reads the enrichment results generated by Script 00 and systematically compares GO and KEGG pathway enrichment across all four Schwann cell types (mySC, nmSC, ImmSC, majorSC) for each intervention comparison. It classifies pathways into three categories: "Shared" (appearing in ≥3 cell types), "Cell-type-specific" (unique to one cell type), and "Partially shared" (appearing in 2 cell types). The analysis generates heatmaps showing the significance (-log10 padj) of top pathways across cell types, dot plots highlighting the most enriched terms, and detailed tables listing which cell types exhibit each pathway. This reveals whether interventions like DREX affect fundamental Schwann cell biology uniformly or trigger distinct molecular programs in different subtypes, which is crucial for understanding the cellular heterogeneity of therapeutic responses.

---

## Script 02: Intervention Response Analysis
**File:** `02_intervention_response.R`
**Output:** `Output_JCI/Intervention_Response/`

This analysis dissects the specific molecular effects of different interventions—diet restriction (DR), exercise (EX), and their combination (DREX)—to identify genes and pathways that are uniquely modulated by each treatment strategy versus those showing synergistic effects. The script examines gene overlaps across intervention comparisons to distinguish DR-specific effects (genes changed in DRvsHFD and HFDvsSD), exercise-specific effects (genes in EXvsHFD), and DREX-specific effects (genes uniquely appearing in DREXvsHFD that weren't in DR or EX alone). It generates Venn diagrams illustrating intervention-specific versus shared gene sets, creates detailed gene lists for each intervention effect category, and produces summary statistics quantifying the magnitude of each intervention's impact across cell types. By comparing these patterns against the human JCI datasets, the analysis reveals which mouse intervention effects are most relevant to human diabetic neuropathy pathology, helping prioritize therapeutic strategies. The outputs include intervention-specific enrichment analyses and visualizations showing whether combined DREX produces additive, synergistic, or unique molecular responses compared to individual interventions.

---

## Script 03: Conservation Analysis
**File:** `03_conservation_analysis.R`
**Output:** `Output_JCI/Conservation_Analysis/`

This analysis identifies genes and pathways that are consistently dysregulated across mouse models and human diabetic neuropathy, providing the strongest candidates for translatable biomarkers and therapeutic targets. The script systematically compares gene expression changes between mouse interventions and human datasets (JCI_SC and JCI_Bulk) to identify "highly conserved" genes—those that appear in overlaps across multiple comparisons and cell types, indicating robust cross-species relevance. It calculates conservation scores based on how frequently each gene appears in mouse-human overlap sets, ranks pathways by their conservation across species and conditions, and generates summary tables listing the most conserved biological processes. The analysis produces pathway comparison heatmaps showing enrichment patterns across species, conservation statistics quantifying the degree of mouse-human concordance for each intervention, and lists of high-confidence translatable genes that show consistent dysregulation. These conserved genes represent the most reliable targets for therapeutic development, as they demonstrate consistent pathology across independent experimental systems and human patient samples.

---

## Script 04: Direction of Change Analysis
**File:** `04_direction_of_change.R`
**Output:** `Output_JCI/Direction_Analysis/`

This analysis goes beyond simple gene overlap to examine whether genes change in the same direction (concordant) or opposite directions (discordant) between mouse and human datasets, which is critical for validating mouse models and interpreting intervention effects. The script reads DEG files with log2 fold changes, maps human genes to mouse orthologs while preserving directionality, and classifies overlapping genes into concordant (same sign of log2FC) or discordant (opposite sign) categories for both Mouse∩JCI_SC and Mouse∩JCI_Bulk comparisons. It generates detailed tables listing concordant and discordant genes with their fold changes in both species, calculates concordance rates (percentage of overlapping genes showing same direction), and produces summary statistics across all comparisons. The analysis creates visualizations showing the proportion of concordant versus discordant changes for each intervention and cell type. High concordance rates validate that mouse interventions recapitulate human disease mechanisms, while discordant genes may reveal species-specific responses or artifacts. This information is crucial for interpreting whether an intervention that "improves" gene expression in mice (e.g., DREX reversing HFD effects) would have the same therapeutic benefit in humans.

---

## Script 05: Leading Edge Genes and Hub Gene Analysis
**File:** `05_leading_edge_genes.R`
**Output:** `Output_JCI/Leading_Edge_Analysis/`

This analysis identifies "hub genes"—genes that appear repeatedly across multiple enriched pathways and intervention comparisons, suggesting they play central regulatory roles in diabetic neuropathy pathophysiology. The script analyzes the gene lists from enrichment results to find genes that participate in numerous significantly enriched GO/KEGG pathways, calculates a "hub score" for each gene based on the number and significance of pathways it contributes to, and identifies genes that are hubs across multiple cell types (cross-cell-type hubs), indicating master regulators of Schwann cell dysfunction. It generates network diagrams visualizing the connections between hub genes and enriched pathways, produces ranked lists of top hub genes with their associated pathways and scores, and creates summary tables showing which hub genes are conserved between mouse and human datasets. Hub genes represent priority therapeutic targets because modulating them could affect multiple disease-relevant pathways simultaneously. The analysis also identifies cell-type-specific versus pan-Schwann-cell hub genes, helping distinguish targets that would broadly affect all Schwann cells from those with subtype-specific effects. Typically, this analysis identifies 10-20 hub genes that warrant detailed mechanistic investigation.

---

## Script 06: Bioenergetic and Metabolic Focus
**File:** `06_bioenergetic_focus.R`
**Output:** `Output_JCI/Bioenergetic_Focus/`

This specialized analysis focuses specifically on metabolic and bioenergetic pathways, which are particularly relevant to diabetic neuropathy where Schwann cell energy metabolism and lactate support for axons are known to be disrupted. Unlike Script 00 which performs broad enrichment across all pathways, this script performs targeted enrichment analysis on curated metabolic gene sets including glycolysis, oxidative phosphorylation, fatty acid metabolism, lactate metabolism, and mitochondrial function. It reads the same mouse DEG files and human datasets but applies bioenergetics-focused filters and annotations, calculates metabolic pathway scores for each comparison, and identifies genes specifically involved in Schwann cell metabolic support of axons. The analysis generates enrichment results emphasizing KEGG metabolic pathways, creates detailed gene lists of dysregulated metabolic genes with their fold changes across species, and produces summary statistics quantifying metabolic dysfunction in each intervention group. The outputs include specialized visualizations showing how different interventions (DR, EX, DREX) affect specific branches of cellular metabolism and whether metabolic gene expression patterns are conserved between mouse and human. This focused analysis complements the broader pathway analysis from Script 00 by providing deep insight into a disease mechanism that is central to diabetic neuropathy pathogenesis and may be particularly amenable to intervention through diet and exercise.

---

## Output Directory Structure

All analyses output to a unified directory structure:

```
Output_JCI/
├── Master_Enrichment_Summary.csv        # Overall summary from Script 00
├── Master_Enrichment_Summary.xlsx       # Excel version with multiple sheets
├── Enrichment_Analysis/                 # Script 00: Raw enrichment results (15 subdirectories)
├── CellType_Comparison/                 # Script 01: Cell-type comparisons
├── Intervention_Response/               # Script 02: Intervention-specific effects
├── Conservation_Analysis/               # Script 03: Cross-species conservation
├── Direction_Analysis/                  # Script 04: Concordance/discordance
├── Leading_Edge_Analysis/               # Script 05: Hub genes and networks
└── Bioenergetic_Focus/                  # Script 06: Metabolic pathways
```

---

## Analysis Workflow

**Required Execution Order:**
1. **First:** Run Script 00 (generates enrichment data)
2. **Then:** Run Scripts 01-05 in any order (all depend on Script 00 output)
3. **Independent:** Script 06 can run anytime (reads DEG files directly)

**Typical Analysis Session:**
```bash
# Step 1: Generate primary enrichment data
Rscript 00_enrichment_JCI_Schwann_mouse.R

# Step 2: Run all downstream analyses (can be parallel or sequential)
Rscript 01_celltype_enrichment_comparison.R
Rscript 02_intervention_response.R
Rscript 03_conservation_analysis.R
Rscript 04_direction_of_change.R
Rscript 05_leading_edge_genes.R

# Step 3: Run specialized metabolic analysis
Rscript 06_bioenergetic_focus.R
```

---

## Key Parameters Applied Across All Scripts

**Cell Types Analyzed:**
- `mySC` - Myelinating Schwann cells
- `nmSC` - Non-myelinating Schwann cells
- `ImmSC` - Immature Schwann cells
- `majorSC` - Combined major Schwann cell population

**Intervention Comparisons:**
- `HFDvsSD` - High-fat diet vs. standard diet (disease model)
- `DRvsHFD` - Diet restriction vs. high-fat diet (DR intervention)
- `EXvsHFD` - Exercise vs. high-fat diet (exercise intervention)
- `DREXvsHFD` - Combined DR+exercise vs. high-fat diet (combination therapy)

**Human Reference Datasets:**
- `JCI_SC` - Human Schwann cell spatial transcriptomics DEGs (Severe vs. Moderate DPN)
- `JCI_Bulk` - Human bulk RNA-seq DEGs from diabetic nerve biopsies

**Enrichment Methods:**
- GO Biological Process (GO:BP) via richR
- KEGG Pathways via richR (with builtin=FALSE)
- Significance threshold: padj < 0.05
- Minimum gene set size for enrichment: 5 genes

---

## Interpretation Guide

**High Overlap with Human Datasets:** Indicates the mouse intervention model recapitulates human disease mechanisms well. These genes/pathways are the most translationally relevant.

**Concordant Direction of Change:** Genes showing the same direction of fold change in mouse and human provide strong validation of disease mechanisms and therapeutic targets.

**Hub Genes:** Genes appearing in multiple enriched pathways across comparisons represent master regulators and priority therapeutic targets.

**Cell-Type-Specific Effects:** Pathways unique to one Schwann cell subtype suggest specialized functions that may require targeted therapeutic approaches.

**Intervention-Specific Genes:** Genes uniquely modulated by DREX (but not by DR or EX alone) reveal synergistic mechanisms and optimal therapeutic strategies.

**Conserved Pathways:** Biological processes enriched consistently across multiple comparisons, cell types, and species represent core disease mechanisms with high confidence.

---

## Citation & Data Sources

**Mouse scRNA-seq Data:** DEG files in `../DEG/` and `../DEG_Major/`
**Human Schwann Cell Data:** `DEGs_JCI_DPN/SchwannDEG_Severe-Moderate_noMito.csv`
**Human Bulk RNA-seq Data:** `DEGs_JCI_DPN/JCI184075.sdd3_BulkRNAseqDEGs.xlsx`
**Gene Orthology Mapping:** homologene package (NCBI HomoloGene database)
**Enrichment Analysis:** richR package (GO.db and KEGG.db via KEGGREST)

---

*Last Updated: December 1, 2025*
*Analysis Pipeline Version: 2.0 (Numbered scripts with unified Output_JCI structure)*
